{% extends "base.html" %}

{% block title %}Resource編集 - Accel MCP{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumb">
    <a href="/dashboard" data-i18n="breadcrumb_home">ホーム</a>
    <span class="breadcrumb-separator">›</span>
    <a href="/resources" data-i18n="resource_list_title">Resources一覧</a>
    <span class="breadcrumb-separator">›</span>
    <span id="resource-name-breadcrumb">...</span>
    <span class="breadcrumb-separator">›</span>
    <span class="breadcrumb-current" data-i18n="resource_edit_title">編集</span>
</nav>
{% endblock %}

{% block content %}
<div class="page-title">
    <h2 data-i18n="resource_edit_title">Resource編集</h2>
    <p data-i18n="resource_edit_desc">リソース情報を編集します</p>
</div>

<div class="form-card">
    <form id="resource-form">
        <div class="form-group">
            <label for="name">
                <span data-i18n="resource_name_label">リソース名</span> *
            </label>
            <input type="text" id="name" name="name" required data-i18n-placeholder="resource_name_placeholder">
            <small data-i18n="resource_name_hint">リソースを識別するための名前</small>
        </div>

        <div class="form-group">
            <label for="mime_type">
                <span data-i18n="resource_mime_type_label">MIMEタイプ</span> *
            </label>
            <select id="mime_type" name="mime_type" required>
                <option value="text/plain">text/plain</option>
                <option value="text/markdown">text/markdown</option>
                <option value="application/json">application/json</option>
                <option value="text/html">text/html</option>
                <option value="text/csv">text/csv</option>
                <option value="application/xml">application/xml</option>
                <option value="text/yaml">text/yaml</option>
            </select>
            <small data-i18n="resource_mime_type_hint">リソースのコンテンツタイプ</small>
        </div>

        <div class="form-group">
            <label><span data-i18n="resource_input_type_label">コンテンツ入力方法</span></label>
            <div style="display: flex; gap: 20px; margin-top: 8px;">
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                    <input type="radio" name="resource_input_type" value="text" checked onchange="toggleResourceInputType()">
                    <span data-i18n="resource_input_text">テキストを直接入力</span>
                </label>
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                    <input type="radio" name="resource_input_type" value="file" onchange="toggleResourceInputType()">
                    <span data-i18n="resource_input_file">ファイルをアップロード</span>
                </label>
            </div>
        </div>

        <div id="resource-text-input" class="form-group">
            <label for="content">
                <span data-i18n="resource_content_label">コンテンツ</span> *
            </label>
            <textarea id="content" name="content" rows="12" required maxlength="10000" data-i18n-placeholder="resource_content_placeholder" oninput="generateResourcePreview(); updateCharCount()"></textarea>
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <small data-i18n="resource_content_hint">最大10,000文字まで入力可能</small>
                <small id="char-count" style="color: #6c757d; font-weight: 500;">0/10,000</small>
            </div>
        </div>

        <div id="resource-file-input" class="form-group" style="display: none;">
            <label for="resource_file"><span data-i18n="resource_file_label">ファイル選択</span></label>
            
            <!-- Drag and Drop Zone -->
            <div id="resource-drop-zone" style="border: 2px dashed #cbd5e0; border-radius: 8px; padding: 40px; text-align: center; background-color: #f7fafc; cursor: pointer; transition: all 0.3s ease;">
                <div style="font-size: 3rem; margin-bottom: 10px;">📄</div>
                <p style="margin: 10px 0; font-size: 1.1rem; font-weight: 500;" data-i18n="resource_drop_here">ファイルをドラッグ＆ドロップ</p>
                <p style="margin: 5px 0; color: #718096;" data-i18n="resource_drop_or">または</p>
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('resource_file').click()" data-i18n="resource_select_file">ファイルを選択</button>
            </div>
            
            <input type="file" id="resource_file" name="resource_file" accept=".txt,.md,.json,.html,.csv,.xml,.yaml,.yml" onchange="handleResourceFileUpload()" style="display: none;">
            <small data-i18n="resource_file_hint" style="color: #6c757d; display: block; margin-top: 8px;">
                対応形式: .txt, .md, .json, .html, .csv, .xml, .yaml (最大20KB)
            </small>
            
            <div id="resource-file-preview" style="display: none; margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span id="resource-file-name" style="font-weight: 600;"></span>
                    <button type="button" onclick="clearResourceFile()" class="btn btn-sm btn-secondary" data-i18n="button_clear">クリア</button>
                </div>
                <small id="resource-file-size" style="color: #6c757d;"></small>
            </div>
        </div>

        <!-- Resource Preview -->
        <div id="resource-preview-section" style="margin-top: 20px; padding: 15px; background-color: #e7f3ff; border-radius: 4px; border-left: 4px solid #007bff;">
            <h4 style="margin-top: 0; font-size: 0.95rem; color: #004085; display: flex; align-items: center; gap: 8px;">
                <span>📄</span> <span data-i18n="resource_preview_title">リソースプレビュー</span>
            </h4>
            <small style="display: block; margin-bottom: 10px; color: #004085;" data-i18n="resource_preview_hint">LLMがこのリソースを読み取ると、以下のコンテンツが返されます</small>
            <pre id="resource-preview-output" style="background: white; padding: 12px; border-radius: 4px; border: 1px solid #007bff; font-size: 0.85rem; overflow-x: auto; margin: 0; white-space: pre-wrap; word-wrap: break-word; max-height: 300px;"></pre>
        </div>

        <div class="form-group">
            <label for="description">
                <span data-i18n="resource_description_label">説明</span>
            </label>
            <textarea id="description" name="description" rows="2" data-i18n-placeholder="resource_description_placeholder"></textarea>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="window.location.href=`/resources/{{ resource_id }}`" data-i18n="button_cancel">キャンセル</button>
            <button type="submit" class="btn btn-primary" data-i18n="button_save">保存</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
const resourceId = {{ resource_id }};
</script>
<script src="/assets/view/resources/edit.js"></script>
{% endblock %}
