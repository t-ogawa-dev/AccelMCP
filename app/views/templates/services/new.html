{% extends "base.html" %}

{% block title %}アプリ新規登録 - Accel MCP{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumb">
    <a href="/dashboard" data-i18n="breadcrumb_home">ホーム</a>
    <span class="breadcrumb-separator">›</span>
    <a href="/services" data-i18n="breadcrumb_app_list">アプリ一覧</a>
    <span class="breadcrumb-separator">›</span>
    <span class="breadcrumb-current" data-i18n="breadcrumb_app_new">新規登録</span>
</nav>
{% endblock %}

{% block content %}
<div class="page-title">
    <h2 data-i18n="app_new_title">アプリ新規登録</h2>
    <p data-i18n="app_new_desc">新しいMCPアプリを登録します</p>
</div>

<div class="form-card">
    <form id="service-form">
        <div class="form-group">
            <label for="name"><span data-i18n="app_name_label">アプリ名</span> *</label>
            <input type="text" id="name" name="name" required>
        </div>
        
        <div class="form-group">
            <label for="subdomain"><span data-i18n="app_subdomain_input">サブドメイン</span> *</label>
            <input type="text" id="subdomain" name="subdomain" required pattern="[a-z0-9-]+" 
                   data-i18n-title="app_subdomain_pattern_hint">
            <small data-i18n="app_subdomain_url_hint">MCP接続URL: http://{subdomain}.lvh.me:5001/mcp (例: http://myapp.lvh.me:5001/mcp)</small>
        </div>
        
        <div class="form-group">
            <label for="description" data-i18n="app_description_label">説明</label>
            <textarea id="description" name="description" rows="3"></textarea>
        </div>
        
        <div class="form-group">
            <label data-i18n="app_type_label">アプリタイプ *</label>
            <div style="display: flex; gap: 20px; margin-top: 8px;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="service_type" value="api" checked onchange="toggleServiceType()">
                    <span style="margin-left: 8px;" data-i18n="app_type_api">API (手動登録)</span>
                </label>
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="radio" name="service_type" value="mcp" onchange="toggleServiceType()">
                    <span style="margin-left: 8px;" data-i18n="app_type_mcp">MCP (自動検出)</span>
                </label>
            </div>
        </div>
        
        <div id="mcp-url-section" style="display: none;">
            <div class="form-group">
                <label for="mcp_url"><span data-i18n="app_mcp_url_label">MCP接続URL</span> *</label>
                <div style="display: flex; gap: 10px; align-items: start;">
                    <div style="flex: 1;">
                        <input type="url" id="mcp_url" name="mcp_url" placeholder="http://localhost:3000/sse">
                        <small data-i18n="app_mcp_url_hint">MCPサーバーのSSEエンドポイントURLを入力してください</small>
                    </div>
                    <button type="button" onclick="testConnection()" class="btn btn-secondary" data-i18n="app_test_connection">接続テスト</button>
                </div>
                <div id="connection-test-result" style="display: none; margin-top: 10px;"></div>
            </div>
        </div>
        
        <div id="common-headers-section">
            <div class="form-group">
                <label data-i18n="app_common_headers_label">共通ヘッダー</label>
                <div id="headers-container"></div>
                <button type="button" onclick="addHeaderRow()" class="btn btn-sm btn-secondary" style="margin-top: 10px;" data-i18n="button_add_header">+ ヘッダーを追加</button>
                <small data-i18n="app_common_headers_hint">全てのCapabilityで使用される共通ヘッダー</small>
            </div>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" data-i18n="button_register">登録</button>
            <a href="/services" class="btn btn-secondary" data-i18n="button_cancel">キャンセル</a>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script src="/assets/view/services/new.js"></script>
{% endblock %}
