{% extends "base.html" %}

{% block title %}Variable編集 - Accel MCP{% endblock %}

{% block breadcrumb %}
<nav class="breadcrumb">
    <a href="/dashboard" data-i18n="breadcrumb_home">ホーム</a>
    <span class="breadcrumb-separator">›</span>
    <a href="/variables" data-i18n="variable_list_title">Variables一覧</a>
    <span class="breadcrumb-separator">›</span>
    <span class="breadcrumb-current" data-i18n="variable_edit_title">Variable編集</span>
</nav>
{% endblock %}

{% block content %}
<div class="page-title">
    <h2 data-i18n="variable_edit_title">Variable編集</h2>
    <p data-i18n="variable_edit_desc">変数情報を編集します</p>
</div>

<div class="form-card">
    <form id="variable-form">
        <div class="form-group">
            <label for="name">
                <span data-i18n="variable_name_label">変数名</span> *
            </label>
            <input type="text" id="name" name="name" required pattern="[A-Z0-9_]+" data-i18n-placeholder="variable_name_placeholder" placeholder="例: OPENAI_API_KEY">
            <small data-i18n="variable_name_hint">英数字とアンダースコアのみ使用可能</small>
        </div>

        <div class="form-group">
            <label>
                <span data-i18n="variable_source_type_label">値の取得元</span> *
            </label>
            <div style="display: flex; gap: 20px; margin-top: 8px;">
                <label class="radio-label">
                    <input type="radio" name="source_type" value="value" id="source-value" onchange="toggleSourceType()">
                    <span data-i18n="variable_source_value">直接入力</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="source_type" value="env" id="source-env" onchange="toggleSourceType()">
                    <span data-i18n="variable_source_env">環境変数</span>
                </label>
            </div>
        </div>

        <div class="form-group" id="value-input-group">
            <label for="value">
                <span data-i18n="variable_value_label">値</span> *
            </label>
            <textarea id="value" name="value" rows="3" required data-i18n-placeholder="variable_value_placeholder" placeholder="変数の値を入力"></textarea>
        </div>

        <div class="form-group" id="env-input-group" style="display: none;">
            <label for="env_var_name">
                <span data-i18n="variable_env_var_name_label">環境変数名</span> *
            </label>
            <div style="display: flex; gap: 10px; align-items: flex-start;">
                <div style="flex: 1;">
                    <input type="text" id="env_var_name" name="env_var_name" data-i18n-placeholder="variable_env_var_name_placeholder" placeholder="例: GITHUB_TOKEN">
                    <small data-i18n="variable_env_var_name_hint">システムの環境変数から値を取得します</small>
                </div>
                <button type="button" onclick="checkEnvVariable()" class="btn btn-secondary" style="white-space: nowrap;">
                    <span data-i18n="button_check_env">確認</span>
                </button>
            </div>
            <div id="env-check-result" style="display: none; margin-top: 10px; padding: 10px; border-radius: 4px;"></div>
        </div>

        <div class="form-group">
            <label>
                <span data-i18n="variable_type_label">値の型</span> *
            </label>
            <div style="display: flex; gap: 20px; margin-top: 8px;">
                <label class="radio-label">
                    <input type="radio" name="value_type" value="string" id="type-string">
                    <span data-i18n="variable_type_string">文字列 (String)</span>
                </label>
                <label class="radio-label">
                    <input type="radio" name="value_type" value="number" id="type-number">
                    <span data-i18n="variable_type_number">数値 (Number)</span>
                </label>
            </div>
            <small data-i18n="variable_type_hint">JSON内でのみ型が保持されます。ヘッダーやURLでは常に文字列として展開されます</small>
        </div>

        <div class="form-group">
            <label for="description">
                <span data-i18n="variable_description_label">説明</span>
            </label>
            <textarea id="description" name="description" rows="2" data-i18n-placeholder="variable_description_placeholder" placeholder="この変数の説明を入力"></textarea>
        </div>

        <div class="form-group">
            <label class="toggle-label">
                <input type="checkbox" id="is_secret" name="is_secret">
                <span data-i18n="variable_is_secret_label">秘匿情報</span>
            </label>
            <small data-i18n="variable_is_secret_hint">ONの場合、一覧で値がマスク表示され、エクスポート時に値が除外されます</small>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="window.location.href='/variables'" data-i18n="button_cancel">キャンセル</button>
            <button type="submit" class="btn btn-primary" data-i18n="button_save">保存</button>
        </div>
    </form>
</div>

{% endblock %}

{% block scripts %}
<script src="/assets/view/variables/edit.js"></script>
{% endblock %}
